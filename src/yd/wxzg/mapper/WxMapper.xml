<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="yd.wxzg.mapper.WxMapper">

 <insert id="addWxMessage">
  insert into tr_message(openid,templateid,content) values(#{openid},#{templateid},#{content})
 </insert>
 <select id="selectFrequency" resultType="java.lang.Integer">
  select frequency from tr_message where openid=#{openid} and templateid=#{templateid} and content=#{content}
 </select>
 <update id="updateRrequency">
  update tr_message set frequency=frequency+1 where openid=#{openid} and templateid=#{templateid} and content=#{content}
 </update>
 <select id="MessageCount" resultType="java.lang.Integer">
  select count(1) from tr_message where openid=#{openid} and templateid=#{templateid} and content=#{content} 
 </select>
 <insert id="addErrmsg">
  insert into error_message(openid,templateid,create_time,content,error_reason) values(#{openid},#{templateid},#{nowTime},#{content},#{error_reason})
 </insert>
 <delete id="deleteFreqy">
  delete from tr_message where id=#{id}
 </delete>
 <select id="errorMessage" resultType="java.lang.Integer">
  select count(1) from error_message where openid=#{openid} and templateid=#{templateid} and content=#{content}
 </select>
 <select id="findMessage" resultType="yd.wxzg.entity.TemplateMessageEntity">
  select id,openid,templateid,content,frequency,endTime,url from tr_message
 </select>
 <update id="insertMessageDate">
  update tr_message set endTime=#{nowTime} where id=#{id}
 </update>
 <update id="insertOpenid">
  UPDATE tr_user SET wx_openid=#{openid},sessionid=#{sessionid},session_key=#{session_key} WHERE password=#{pass} and username=#{name}
 </update>
 <!-- <select id="getwxuser" resultType="yd.slgl.entity.UsersEntity">
  SELECT user_id,NAME,dj FROM tr_user WHERE wx_id=#{wx_id}
 </select> -->
 <select id="getwxuser" resultType="yd.slgl.entity.UsersEntity">
 SELECT user_id,NAME,dj,mobile,dept_name,gender,zw FROM tr_user WHERE wx_openid=#{wx_id}
 </select>
 <select id="getwxsession" resultType="yd.slgl.entity.UsersEntity">
 SELECT wx_openid,session_key,sessionid FROM tr_user WHERE sessionid=#{sessionid}
 </select>
 <update id="updateSession">
 UPDATE tr_user SET wx_openid=#{openid},sessionid=#{sessionid},session_key=#{session_key} WHERE wx_openid=#{openid}
 </update>
 <select id="selectuser" resultType="yd.slgl.entity.UsersEntity">
  SELECT user_id,username,password,wx_openid FROM tr_user WHERE username=#{username} AND password=#{password}
 </select>
</mapper>