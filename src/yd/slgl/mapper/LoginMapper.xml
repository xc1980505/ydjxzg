<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="yd.slgl.mapper.LoginMapper">
 <select id="getLogin" resultType="yd.slgl.entity.UsersEntity">
  select user_id,username,gender,name,dj,user_status from tr_user where 1=1
  <if test="username!=null">
   and username=#{username}
  </if>
  <if test="password!=null">
   and password=#{password}
  </if>
 </select>
 <select id="getPermis" resultType="yd.htgl.entity.Permis">
SELECT permis_id,permis_name,permis_icon,permis_order,remark FROM tr_permis WHERE permis_order=1 AND permis_id IN
 (SELECT permis_id FROM role_permis WHERE role_id IN 
 (SELECT role_id FROM user_role WHERE user_id=#{user_id})) GROUP BY permis_id
 </select>
 <select id="getPerm" resultType="yd.htgl.entity.Permis">
SELECT permis_id,permis_name,permis_icon,permis_order,remark FROM tr_permis WHERE permis_id IN
 (SELECT permis_id FROM role_permis WHERE role_id IN 
 (SELECT role_id FROM user_role WHERE user_id=#{user_id})) GROUP BY permis_id
 </select>
 <select id="getPer" resultType="yd.htgl.entity.Permis">
 SELECT permis_id,permis_name,permis_icon,permis_order,remark FROM tr_permis WHERE parent_permis=#{parent_permis} AND permis_id IN
 (SELECT permis_id FROM role_permis WHERE role_id IN 
 (SELECT role_id FROM user_role WHERE user_id=#{user_id})) GROUP BY permis_id
 </select>
 <select id="getdenglu" resultType="java.lang.Integer">
 SELECT COUNT(1) FROM tr_user WHERE username=#{username} AND mobile=#{mobile}
 </select>
 <select id="getpassword" resultType="yd.slgl.entity.UsersEntity">
 select user_id,username,password,gender,name,dj,user_status from tr_user where username=#{username}
 </select>
 <update id="upPassword">
 UPDATE tr_user SET password=#{password} WHERE username=#{username}
 </update>
</mapper>