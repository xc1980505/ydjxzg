webpackJsonp([6],{"9ebi":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s("wtEF"),r=(s("aozt"),s("mZiP"),{name:"tree",inject:["reload"],data:function(){return{watchProgress:"",flag:!0,watchFlag:"",dialogDelete:!1,dialogPassword:!1,userPassword:"",level:"2",brother:"1",treedata:{},handleData:null,resolve:{title:"分解项目节点",level:"2",id:"1",mc:"项目名称项目名称",important:"",leader:""},del:{title:"",level:"",id:""}}},methods:{handleNodeClick:function(e){console.log(e)},handleEdit:function(e){console.log(e),console.log(this.$route.query),localStorage.setItem("data",e),console.log(e.level),console.log(this.level);var t=this.$route.query.id,s=this.$route.query.dj,o=window.sessionStorage.getItem("user_id"),r=window.sessionStorage.getItem("userdj");console.log(r),console.log(o),console.log(e.creator_id),1==r&&this.user_id==e.manager_id&&1==e.target_dj?this.$router.push({path:"/edit",name:"edit",query:{level:e.level,id:e.id,fid:t,fdj:s}}):o==e.creator_id?this.$router.push({path:"/edit",name:"edit",query:{level:e.level,id:e.id,fid:t,fdj:s}}):this.$message({message:"您不能修改上级分解给您的目标!",type:"warning"})},handleResolve:function(e){console.log(e),console.log(e.level),console.log(this.level),console.log(this.$route.query);var t=this.$route.query.id,s=this.$route.query.dj;console.log(t+s);var o=window.sessionStorage.getItem("user_id");console.log(o);sessionStorage.getItem("shifoufenjie");4==e.target_dj?this.$message({message:"此项目不能分解!",type:"warning"}):o==e.manager_id?this.$router.push({path:"/resolve",name:"resolve",query:{id:e.id,dj:e.target_dj,fid:t,fdj:s}}):this.$message({message:"您没有权限分解非您负责的项目！",type:"warning"})},handleDelete:function(e){if(console.log(e),localStorage.setItem("id",e.id),localStorage.setItem("dj",e.target_dj),console.log(localStorage.getItem("id"),"ididididididid"),console.log(localStorage.getItem("dj")),window.sessionStorage.getItem("user_id")==e.creator_id){if(e.target_name){var t=e.target_name.substr(8,12);console.log(t)}this.del.title=e.title,this.del.level=e.level,this.del.id=e.id,this.dialogDelete=!0}else this.$message({message:"您没有权限操作此项目!",type:"warning"})},cancleHandle:function(){this.$refs.handleMenu.style.display="none"},dele:function(){console.log(this.del),this.dialogPassword=!0},showPsw:function(){"iconfont icon-guanbixianshi"==$("#eye").attr("class")?($("#eye").removeClass("icon-guanbixianshi").addClass("icon-xianshi"),$("#userPsw").attr("type","text")):($("#eye").removeClass("icon-xianshi").addClass("icon-guanbixianshi"),$("#userPsw").attr("type","password"))},confirm:function(){if("123456"==this.userPassword){this.dialogDelete=!1;var e=this,t=localStorage.getItem("id"),s=localStorage.getItem("dj");localStorage.setItem("dj",s),$.ajax({type:"post",url:e.baseUrl+"/ydjxzg/mb/deleteTarger.action",data:{targetid:t,targetdj:s},async:!1,dataType:"json",success:function(t){console.log(t),e.$message.success("删除成功!"),e.dialogPassword=!1,1==localStorage.getItem("dj")?e.$router.push({path:"/zgmb",query:{shuaxin:1}}):e.reload()}})}else""==this.userPassword?this.$message({message:"密码不能为空!",type:"warning"}):this.$message({message:"密码错误!",type:"warning"})},init:function(){console.log(this.$route.query);var e=this.$route.query.id,t=this.$route.query.dj;console.log("等级"+t);var s=this;$.ajax({type:"post",url:s.baseUrl+"/ydjxzg/mb/projectTree.action",data:{targetid:e},async:!1,dataType:"json",success:function(e){console.log(e),e.projectTree&&(e.projectTree.title=e.projectTree.target_name,s.treedata=e.projectTree,console.log(s.treedata)),e.targetOne&&(s.level=e.targetOne.level,s.brother=e.targetOne.brother,console.log(s.brother))}})}},mounted:function(){this.init();var e=this;console.log(e.treedata),$("#chart-container").orgchart({data:e.treedata,nodeContent:"manager_name",nodeTitle:"title",createNode:function(t,s){document.oncontextmenu=function(e){return!1},t.mousedown(function(t){if(3==t.which){var r=window.sessionStorage.getItem("user_id");e.handleData=s,e.$refs.handleMenu.style.display="block",o.a.state.isCollapse?e.$refs.handleMenu.style.left=t.clientX-235+"px":e.$refs.handleMenu.style.left=t.clientX-105+"px",e.$refs.handleMenu.style.top=t.clientY-90+"px",e.watchProgress=s.progress,e.watchFlag=s.level,r==s.creator_id&&r==s.manager_id?(e.$refs.cur1.style.cursor="default",e.$refs.cur2.style.cursor="default",e.$refs.cur3.style.cursor="default"):r==s.creator_id&&r!==s.manager_id?(e.$refs.cur1.style.cursor="default",e.$refs.cur2.style.cursor="not-allowed",e.$refs.cur3.style.cursor="default"):r!==s.creator_id&&r==s.manager_id?(e.$refs.cur1.style.cursor="not-allowed",e.$refs.cur2.style.cursor="default",e.$refs.cur3.style.cursor="not-allowed"):(e.$refs.cur1.style.cursor="not-allowed",e.$refs.cur2.style.cursor="not-allowed",e.$refs.cur3.style.cursor="not-allowed")}else 1==t.which&&(e.$refs.handleMenu.style.display="none")}),t.dblclick(function(){var t=localStorage.getItem("creid"),o=window.sessionStorage.getItem("user_id");t==o?e.$router.push({path:"/detail",name:"detail",query:{id:s.id,userid:o}}):e.$message({message:"您没有权限操作此项目!",type:"warning"})});var r=$("<i>",{class:"fa fa-info-circle second-menu-icon",click:function(){$(this).siblings(".second-menu").toggle("fast")}}),a='<div class="second-menu titleInfo"><p>'+s.title+"</p></div>";t.append(r).append(a)}}),$(".card").scroll(function(){e.$refs.handleMenu.style.display="none"})},watch:{$route:{handler:function(e){"tree"==e.name&&this.reload()},deep:!0},watchFlag:function(e,t){void 0==e||(this.flag=4!=e)},watchProgress:function(e,t){void 0==e||(this.flag=0==e)}}}),a={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"tree"}},[s("el-row",[s("el-col",{attrs:{span:24}},[s("el-card",{ref:"card",staticClass:"card",attrs:{shadow:"always"},nativeOn:{click:function(t){return e.cancleHandle()}}},[s("div",{attrs:{id:"chart-container"}}),e._v(" "),s("div",{ref:"handleMenu",staticClass:"handleMenu"},[s("span",{ref:"cur1",staticClass:"edit",on:{click:function(t){return e.handleEdit(e.handleData)}}},[e._v("编辑项目信息")]),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:e.flag,expression:"flag"}],ref:"cur2",staticClass:"resolve",on:{click:function(t){return e.handleResolve(e.handleData)}}},[e._v("分解项目节点")]),e._v(" "),s("span",{ref:"cur3",staticClass:"delete",on:{click:function(t){return e.handleDelete(e.handleData)}}},[e._v("删除项目节点")])])])],1)],1),e._v(" "),s("el-dialog",{staticClass:"delTips",attrs:{title:"谨慎操作提示",visible:e.dialogDelete,top:"30vh",width:"300px"},on:{"update:visible":function(t){e.dialogDelete=t}}},[s("el-dialog",{staticClass:"delTips",attrs:{width:"300px",title:"请输入登录密码以确认",visible:e.dialogPassword,top:"30vh","append-to-body":""},on:{"update:visible":function(t){e.dialogPassword=t}}},[s("div",{staticClass:"psw"},[s("el-input",{attrs:{type:"password",id:"userPsw",placeholder:"请输入您的登录密码"},model:{value:e.userPassword,callback:function(t){e.userPassword=t},expression:"userPassword"}}),e._v(" "),s("span",{staticClass:"iconfont icon-guanbixianshi",attrs:{id:"eye"},on:{click:function(t){return e.showPsw()}}})],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogPassword=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.confirm()}}},[e._v("确 认")])],1)]),e._v(" "),s("span",[e._v("你确定要删除“"),s("b",[e._v(e._s(e.del.title))]),e._v("”此项目吗？其子项目也将会随之删除！")]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogDelete=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dele()}}},[e._v("删 除")])],1)],1)],1)},staticRenderFns:[]};var n=s("C7Lr")(r,a,!1,function(e){s("h3mj")},null,null);t.default=n.exports},h3mj:function(e,t){},mZiP:function(e,t){t.endianness=function(){return"LE"},t.hostname=function(){return"undefined"!=typeof location?location.hostname:""},t.loadavg=function(){return[]},t.uptime=function(){return 0},t.freemem=function(){return Number.MAX_VALUE},t.totalmem=function(){return Number.MAX_VALUE},t.cpus=function(){return[]},t.type=function(){return"Browser"},t.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},t.networkInterfaces=t.getNetworkInterfaces=function(){return{}},t.arch=function(){return"javascript"},t.platform=function(){return"browser"},t.tmpdir=t.tmpDir=function(){return"/tmp"},t.EOL="\n",t.homedir=function(){return"/"}}});
//# sourceMappingURL=6.f60a39152f49d8c90874.js.map